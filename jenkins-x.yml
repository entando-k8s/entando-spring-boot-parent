buildPack: maven-java11
pipelineConfig:
  agent:
    image: maven-java11
  env:
    - name: GPG_PASSPHRASE
      valueFrom:
        secretKeyRef:
          name: entando-jx-common-secret
          key: gpg.passphrase
    - name: GPG_KEYNAME
      valueFrom:
        secretKeyRef:
          name: entando-jx-common-secret
          key: gpg.keyname
    - name: GPG_HOMEDIR
      valueFrom:
        secretKeyRef:
          name: entando-jx-common-secret
          key: gpg.homedir
  pipelines:
    pullRequest:
      build:
        replace: true
        steps:
          - sh: mvn versions:set -DnewVersion=$PREVIEW_VERSION
            name: set-version
          - sh: git fetch origin
            name: fetch-full-repo
          - sh: >-
              mvn clean verify
            name: mvn-verify
      promote:
        replace: true
        steps: []
    release:
      build:
        replace: true
        steps:
          - sh: git fetch origin
            name: fetch-full-repo
          - sh: >-
              mvn clean deploy \
                -Dgpg.homedir=${GPG_HOMEDIR} \
                -Dgpg.keyname=${GPG_KEYNAME} \
                -Dgpg.passphrase=${GPG_PASSPHRASE}
            name: mvn-deploy
      promote:
        replace: true
        steps: []
